<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>‡§∞‡•á‡§´‡§∞‡§≤ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</title>

<style>
/* ===== Global ===== */
body{
    margin:0;
    font-family:"Segoe UI",Tahoma,Arial;
    background:#f2f4f7;
    display:flex;
}

/* ===== Sidebar ===== */
.sidebar{
    position:fixed;
    top:0;left:0;
    width:230px;height:100%;
    background:#e8f1f8;
    border-right:1px solid #c3d4e6;
}
.sidebar::before{
    content:"Government Services";
    display:block;
    background:#003366;
    color:#fff;
    padding:14px 16px;
    font-weight:600;
}
.sidebar a{
    display:block;
    padding:12px 18px;
    color:#003366;
    text-decoration:none;
    border-bottom:1px solid #d5e2ee;
}
.sidebar a#logoutSidebar {
    color: #ff3333;
    font-weight: 600;
}
.sidebar a#logoutSidebar:hover {
    background: #ffe6e6;
}

/* ===== Main ===== */
.main{margin-left:230px;width:100%;padding-bottom:50px;}

/* ===== Header ===== */
header{
    background:linear-gradient(90deg,#ff9933,#ffffff,#138808);
    border-bottom:3px solid #003366;
    padding:10px 18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.profile-wrapper{
    position:relative;
}
.profile-wrapper img{
    width:38px;height:38px;border-radius:50%;
    border:2px solid #003366;
    cursor:pointer;
}
#logoutMenu{
    display:none;
    position:absolute;
    right:0;top:50px;
    background:#fff;
    border:1px solid #ccc;
    border-radius:6px;
    padding:8px;
    width:100px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    cursor:pointer;
}
#logoutMenu:hover{ background:#ff3333; color:#fff; }

/* ===== Referral Section ===== */
.container{
    max-width:700px;
    margin:20px auto;
    background:#fff;
    border-radius:10px;
    padding:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
.referral-box{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#f9f9f9;
    border:1px solid #c3d4e6;
    padding:12px 18px;
    border-radius:6px;
    margin-bottom:20px;
}
.referral-box span{
    font-weight:600;
    font-size:16px;
    color:#003366;
}
.copy-btn{
    padding:6px 12px;
    background:#006600;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.copy-btn:hover{background:#005500;}
.referral-list{
    margin-top:20px;
}
.referral-list h2{
    color:#003366;
    font-size:18px;
    margin-bottom:12px;
}
.referral-list ul{
    list-style:none;
    padding-left:0;
}
.referral-list li{
    padding:10px 12px;
    border-bottom:1px solid #c3d4e6;
    font-size:15px;
}
#inactiveMsg{
    text-align:center;
    color:#c62828;
    font-weight:600;
    margin-top:15px;
}

/* ===== Footer ===== */
.gov-footer{
    background:#003366;
    color:#fff;
    text-align:center;
    padding:20px;
    font-size:13px;
    border-top:4px solid #ff9933;
}
.gov-footer a{color:#ffcc00;text-decoration:none;}
</style>
</head>

<body>

<div class="sidebar">
    <a href="dashboard.html">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</a>
    <a href="profile.html">‡§Ü‡§µ‡•á‡§¶‡§ï ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</a>
    <a href="activation.html">‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§∞‡•á</a>
    <a href="refferal.html" style="font-weight:bold;">‡§∞‡•á‡§´‡§∞‡§≤</a>
    <a href="#">‡§∏‡§™‡•ã‡§∞‡•ç‡§ü</a>
    <a href="#" id="logoutSidebar">‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü</a>
</div>

<div class="main">
<header>
    <h3>‡§¨‡•á‡§ü‡•Ä ‡§ú‡•Ä‡§µ‡§® ‡§ï‡§≤‡•ç‡§Ø‡§æ‡§£ ‡§Ø‡•ã‡§ú‡§®‡§æ</h3>
    <div class="profile-wrapper">
        <img id="profileImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <div id="logoutMenu">‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü</div>
    </div>
</header>

<div class="container">
    <div class="referral-box" id="refBox" style="display:none">
        <span id="refCode">REF-XXXXXX</span>
        <button class="copy-btn" onclick="copyReferral()">‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <p id="inactiveMsg">
        ‡§Ü‡§™‡§ï‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§Ö‡§≠‡•Ä ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§  
        ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§™‡•Ç‡§∞‡§æ ‡§π‡•ã‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∞‡•á‡§´‡§∞‡§≤ ‡§ï‡•ã‡§° ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã‡§ó‡§æ‡•§
    </p>

    <div class="referral-list">
        <h2>‡§Ü‡§™‡§ï‡•á ‡§∞‡•á‡§´‡§∞‡§≤‡•ç‡§∏:</h2>
        <ul id="referralsUl">
            <li>‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</li>
        </ul>
    </div>
</div>
</div>


<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAPSLZU2rGmBTjugMGXzLHpznOaRUW3i4k",
  authDomain: "betikalyanyojnaind.firebaseapp.com",
  projectId: "betikalyanyojnaind",
  storageBucket: "betikalyanyojnaind.firebasestorage.app",
  messagingSenderId: "646974816722",
  appId: "1:646974816722:web:6b0c9c8960d1846a8e480b"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// üîê AUTH CHECK
auth.onAuthStateChanged(user=>{
    if(!user){
        window.location.href="index.html";
        return;
    }
    const aadhaar = user.email.split("@")[0];
    loadReferralData(aadhaar);
});

function loadReferralData(aadhaar){
    db.collection("users").doc(aadhaar).get().then(doc=>{
        if(!doc.exists) return;

        const user = doc.data();

        // üîí NOT ACTIVATED
        if(!user.activated){
            refBox.style.display="none";
            inactiveMsg.style.display="block";
            referralsUl.innerHTML="<li>‡§ñ‡§æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§π‡•ã‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∞‡•á‡§´‡§∞‡§≤ ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•á</li>";
            return;
        }

        // ‚úÖ ACTIVATED
        refBox.style.display="flex";
        inactiveMsg.style.display="none";
        refCode.innerText = user.ownReferral;

        // üîÅ LOAD ONLY MY REFERRALS
        db.collection("users")
        .where("referredBy","==",user.ownReferral)
        .get()
        .then(snapshot=>{
            if(snapshot.empty){
                referralsUl.innerHTML="<li>‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§∞‡•á‡§´‡§∞‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</li>";
                return;
            }

            let html="";
            snapshot.forEach(d=>{
                const r=d.data();
                html+=`<li>
                    ${r.name} (${r.aadhaar}) ‚Äì
                    <strong>${r.activated ? "Activated" : "Pending"}</strong>
                </li>`;
            });
            referralsUl.innerHTML=html;
        });
    });
}

function copyReferral(){
    navigator.clipboard.writeText(refCode.innerText)
    .then(()=>alert("‡§∞‡•á‡§´‡§∞‡§≤ ‡§ï‡•ã‡§° ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à"));
}

// LOGOUT
document.getElementById("logoutSidebar").onclick=e=>{
    e.preventDefault();
    auth.signOut().then(()=>window.location.href="index.html");
};
profileImg.onclick=()=>logoutMenu.style.display=
    logoutMenu.style.display==="block"?"none":"block";
logoutMenu.onclick=()=>auth.signOut().then(()=>window.location.href="index.html");
</script>


</footer>
</body>
</html>
