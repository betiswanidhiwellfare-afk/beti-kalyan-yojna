<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>‡§¨‡§æ‡§≤ ‡§ú‡•Ä‡§µ‡§® ‡§ï‡§≤‡•ç‡§Ø‡§æ‡§£ ‡§Ø‡•ã‡§ú‡§®‡§æ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ‚ùå UI NOT TOUCHED */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Noto Sans Devanagari","Mangal","Segoe UI",Arial,sans-serif;}
body{background:#f3f6f9;}
.flag-strip{height:60px;background:linear-gradient(to bottom,#ff9933 0%,#ff9933 33%,#ffffff 33%,#ffffff 66%,#138808 66%,#138808 100%);display:flex;align-items:center;justify-content:center;border-bottom:2px solid #ccc;}
.flag-strip img{height:42px;background:#fff;border-radius:50%;padding:4px;}
.header-title{background:#0b5394;color:#fff;padding:12px;text-align:center;font-size:20px;font-weight:600;}
.container{max-width:460px;margin:30px auto;background:#fff;border:1px solid #cfd8e3;border-radius:6px;box-shadow:0 6px 15px rgba(0,0,0,0.1);}
.container h2{text-align:center;padding:15px;color:#0b5394;border-bottom:1px solid #ddd;}
.pay-amount{text-align:center;font-size:18px;font-weight:700;color:#b71c1c;padding:10px;background:#fff3f3;border-bottom:1px solid #f0caca;}
.section{padding:15px;border-bottom:1px solid #eee;}
.section h3{font-size:16px;color:#333;margin-bottom:8px;}
.detail{font-size:14px;margin:5px 0;}
.detail span{font-weight:600;}
.qr{text-align:center;margin-top:10px;}
.qr img{width:170px;border:1px solid #ccc;padding:5px;}
form{padding:15px;}
label{font-size:14px;margin-top:10px;display:block;}
input{width:100%;padding:8px;margin-top:5px;border:1px solid #b0bec5;border-radius:4px;}
button{width:100%;margin-top:15px;padding:10px;background:#0b5394;border:none;color:#fff;font-size:15px;border-radius:4px;cursor:pointer;}
button:hover{background:#083b6f;}
.note{font-size:12px;color:#555;text-align:center;padding:10px;background:#f5f7fa;border-top:1px solid #ddd;}
.status{text-align:center;font-size:14px;font-weight:600;padding:10px;}
.pending{color:#c62828;}
.activated{color:#2e7d32;}
</style>
</head>

<body>

<div class="flag-strip">
<img src="https://upload.wikimedia.org/wikipedia/commons/1/17/Ashoka_Chakra.svg">
</div>

<div class="header-title">‡§¨‡§æ‡§≤ ‡§ú‡•Ä‡§µ‡§® ‡§ï‡§≤‡•ç‡§Ø‡§æ‡§£ ‡§Ø‡•ã‡§ú‡§®‡§æ</div>

<div class="container">
<h2>‡§ñ‡§æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø‡§£ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®</h2>

<div class="pay-amount">‡§ñ‡§æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø‡§£ ‡§π‡•á‡§§‡•Å ‚Çπ600 ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç</div>

<div class="section">
<h3>‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
<div class="detail">‡§¨‡•à‡§Ç‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ: <span>‡§∏‡•ç‡§ü‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï ‡§ë‡§´ ‡§á‡§Ç‡§°‡§ø‡§Ø‡§æ</span></div>
<div class="detail">‡§ñ‡§æ‡§§‡§æ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ: <span>123456789012</span></div>
<div class="detail">IFSC ‡§ï‡•ã‡§°: <span>SBIN0001234</span></div>
<div class="detail">UPI ‡§Ü‡§à‡§°‡•Ä: <span>example@upi</span></div>
<div class="qr">
<p style="font-size:13px;margin-bottom:6px;">QR ‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç</p>
<img src="qr.png">
</div>
</div>

<form id="activationForm">
<label>‡§≤‡•á‡§®-‡§¶‡•á‡§® / UTR ‡§®‡§Ç‡§¨‡§∞</label>
<input type="text" id="utr" required>

<label>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</label>
<input type="file" id="screenshot" accept="image/*" required>

<button type="submit">‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§π‡•á‡§§‡•Å ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç</button>
</form>

<div id="statusBox" class="status"></div>
<div class="note">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§ï‡•á ‡§â‡§™‡§∞‡§æ‡§Ç‡§§ ‡§ñ‡§æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</div>
</div>

<!-- üî• Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>


<script>


// üî• Firebase config (same as admin)
firebase.initializeApp({
  apiKey: "AIzaSyAPSLZU2rGmBTjugMGXzLHpznOaRUW3i4k",
  authDomain: "betikalyanyojnaind.firebaseapp.com",
  projectId: "betikalyanyojnaind",
  storageBucket: "betikalyanyojnaind.firebasestorage.app",
  messagingSenderId: "646974816722",
  appId: "1:646974816722:web:6b0c9c8960d1846a8e480b"
});

const db = firebase.firestore();
const statusBox = document.getElementById("statusBox");

// üîé real-time status listener
firebase.auth().onAuthStateChanged(user=>{
    if(!user) return;

    const aadhaar = user.email.split("@")[0];
    db.collection("payments").where("aadhaar","==",aadhaar)
    .onSnapshot(snapshot=>{
        snapshot.forEach(doc=>{
            showStatus(doc.data().status);
        });
    });
});



// üì§ submit payment

firebase.auth().onAuthStateChanged(user=>{
    if(!user){
        window.location.href="index.html";
        return;
    }

    const aadhaar = user.email.split("@")[0];

    document.getElementById("activationForm").addEventListener("submit", e=>{
        e.preventDefault();

        const utr = document.getElementById("utr").value;
        const file = document.getElementById("screenshot").files[0];

        db.collection("payments")
        .where("aadhaar","==",aadhaar)
        .where("status","in",["Pending","Activated"])
        .get()
        .then(snap=>{
            if(!snap.empty){
                alert("‡§Ü‡§™ ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ú‡§Æ‡§æ ‡§ï‡§∞ ‡§ö‡•Å‡§ï‡•á ‡§π‡•à‡§Ç");
                return;
            }

            return db.collection("users").doc(aadhaar).get();
        })
        .then(userDoc=>{
            if(!userDoc || !userDoc.exists) return;

            const reader = new FileReader();
            reader.onload = ()=>{
                db.collection("payments").add({
                    aadhaar: aadhaar,
                    username: userDoc.data().name,
                    utr: utr,
                    screenshot: reader.result,
                    status: "Pending",
                    date: firebase.firestore.FieldValue.serverTimestamp()
                }).then(()=>{
                    alert("‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡§Æ‡§æ ‡§π‡•Å‡§Ü");
                    showStatus("Pending");
                    e.target.reset();
                });
            };
            reader.readAsDataURL(file);
        });
    });
});


// üìå status UI
function showStatus(status){
    statusBox.innerText = "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø: " + status;
    statusBox.className = "status " + (status==="Activated"?"activated":"pending");
}
</script>

</body>
</html>
